{% extends "base.html" %}
{% block content %}
<h1>ЁЯй║ O-Health LLM рдРрдк / O-Health LLM App</h1>
<p>O-Health LLM рдРрдк рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред рдЖрдк рд╣рд┐рдВрджреА рдореЗрдВ рдЕрдкрдиреЗ рд▓рдХреНрд╖рдг рдмреЛрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЕрдВрдЧреНрд░реЗрдЬреА рдореЗрдВ рдЯрд╛рдЗрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдкрдХреЛ рдЖрдкрдХреЗ рдЗрдирдкреБрдЯ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реЛрдЧ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ рдорд┐рд▓ рд╕рдХреЗрдВред / Welcome to the O-Health LLM App. You can either speak your symptoms in Hindi or type them in English to receive potential disease recommendations based on your inputs.</p>

<form action="{{ url_for('home') }}" method="post">
    <label for="symptoms">рдЕрдкрдиреЗ рд▓рдХреНрд╖рдг рджрд░реНрдЬ рдХрд░реЗрдВ / Enter your symptoms:</label><br>
    <textarea id="symptoms" name="symptoms" rows="5" cols="50"></textarea><br>
    <button type="button" onclick="startDictation('symptoms')">ЁЯОд рдмреЛрд▓реЗрдВ / Speak</button><br><br>
    <input type="submit" value="рд▓рдХреНрд╖рдг рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ / Submit Symptoms">
</form>

{% if error %}
<p style="color:red;">{{ error }}</p>
{% endif %}

<script>
function startDictation(textareaId) {
    if (window.hasOwnProperty('webkitSpeechRecognition')) {
        var recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'hi-IN';  // Set language to Hindi

        recognition.onstart = function() {
            console.log("Speech recognition started.");
            alert("рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рд╕рдХреНрд░рд┐рдп рд╣реИ, рдХреГрдкрдпрд╛ рдмреЛрд▓реЗрдВ...");  // "Microphone is active, please speak..."
        };

        recognition.onresult = function(e) {
            var transcript = e.results[0][0].transcript;
            console.log("Transcript received: " + transcript);
            document.getElementById(textareaId).value = transcript;
            recognition.stop();
        };

        recognition.onerror = function(e) {
            console.error("Speech recognition error:", e.error);
            alert("рд╡реЙрдЗрд╕ рд░рд┐рдХрдЧреНрдирд┐рд╢рди рдореЗрдВ рддреНрд░реБрдЯрд┐ рд╣реБрдИ: " + e.error);  // "Voice recognition error: ..."
            recognition.stop();
        };

        recognition.onend = function() {
            console.log("Speech recognition ended.");
        };

        recognition.start();
    } else {
        alert("рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡реЙрдЗрд╕ рд░рд┐рдХрдЧреНрдирд┐рд╢рди рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рдХреГрдкрдпрд╛ рдЕрдкрдиреЗ рд▓рдХреНрд╖рдг рдЯрд╛рдЗрдк рдХрд░реЗрдВред");  // "Your browser does not support voice recognition. Please type your symptoms."
    }
}

function speakWelcomeMessage() {
    if ('speechSynthesis' in window) {
        var msg = new SpeechSynthesisUtterance("O-Health LLM рдРрдк рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред рдХреГрдкрдпрд╛ рдЕрдкрдиреЗ рд▓рдХреНрд╖рдг рдмреЛрд▓реЗрдВ рдпрд╛ рдЯрд╛рдЗрдк рдХрд░реЗрдВред");
        msg.lang = 'hi-IN';  // Set language to Hindi

        // Select a more human-like Hindi voice
        var voices = window.speechSynthesis.getVoices();
        for(var i = 0; i < voices.length; i++) {
            if(voices[i].lang === 'hi-IN' && voices[i].name.includes('Hindi')) {
                msg.voice = voices[i];
                break;
            }
        }

        window.speechSynthesis.speak(msg);
    }
}

// Automatically speak the welcome message when the page loads
window.onload = function() {
    // Delay to ensure voices are loaded
    setTimeout(speakWelcomeMessage, 500);
};
</script>
{% endblock %}
